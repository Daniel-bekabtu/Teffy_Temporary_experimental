<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Lands - Teffy Africa</title>
    <style>
      :root {
        --primary-green: #1a8d5f;
        --dark-green: #147a4f;
        --light-green: rgba(26, 141, 95, 0.1);
        --white: #ffffff;
        --glass-bg: rgba(255, 255, 255, 0.85);
        --glass-border: rgba(26, 141, 95, 0.2);
        --error-red: #ff4444;
        --success-green: #00c851;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
      }

      body {
        min-height: 100vh;
        background: #ffffff;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
        position: relative;
      }

      #particles-js {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
      }

      .main-content {
        position: relative;
        z-index: 1;
        flex: 1;
        width: 100%;
        padding-top: 2rem;
        padding-bottom: 2rem;
        min-height: 100vh;
      }

      /* Lands Grid Layout */
      .lands-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
      }

      .land-card {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        overflow: hidden;
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
        cursor: pointer;
      }

      .land-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(26, 141, 95, 0.15);
      }

      .land-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-bottom: 1px solid var(--glass-border);
      }

      .land-content {
        padding: 1.5rem;
      }

      .land-title {
        font-size: 1.25rem;
        color: var(--primary-green);
        margin-bottom: 0.5rem;
        font-weight: 600;
      }

      .land-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin: 1rem 0;
      }

      .detail-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #666;
        font-size: 0.9rem;
      }

      .detail-icon {
        color: var(--primary-green);
        width: 18px;
        height: 18px;
      }

      .land-status {
        display: inline-block;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
        margin-top: 1rem;
      }

      .status-verified {
        background: var(--light-green);
        color: var(--primary-green);
      }

      .status-pending {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
      }

      .land-description {
        margin-top: 1rem;
        color: #666;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .land-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1.5rem;
        padding-top: 1rem;
        border-top: 1px solid var(--glass-border);
      }

      .land-price {
        color: var(--primary-green);
        font-weight: 600;
        font-size: 1.1rem;
      }

      .view-details {
        background: var(--primary-green);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .view-details:hover {
        background: var(--dark-green);
      }

      /* Empty state */
      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #666;
        background: var(--glass-bg);
        border-radius: 20px;
        margin: 2rem auto;
        max-width: 600px;
      }

      .empty-state svg {
        width: 80px;
        height: 80px;
        color: var(--primary-green);
        margin-bottom: 1.5rem;
      }

      .empty-state h2 {
        color: var(--primary-green);
        margin-bottom: 1rem;
      }

      .empty-state p {
        max-width: 400px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .register-land-btn {
        display: inline-block;
        background: var(--primary-green);
        color: white;
        text-decoration: none;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        margin-top: 1.5rem;
        transition: background 0.3s ease;
      }

      .register-land-btn:hover {
        background: var(--dark-green);
      }

      @media (max-width: 768px) {
        .lands-container {
          grid-template-columns: 1fr;
          padding: 1rem;
        }

        .land-card {
          margin-bottom: 1rem;
        }

        .main-content {
          padding-top: 1rem;
          padding-bottom: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="particles-js"></div>
    <main class="main-content">
      <div class="lands-container">
        <!-- Sample Land Card -->
        <div class="land-card">
          <img
            src="https://images.unsplash.com/photo-1500382017468-9049fed747ef"
            alt="Farm Land"
            class="land-image"
          />
          <div class="land-content">
            <h3 class="land-title">Fertile Valley Farm</h3>
            <div class="land-details">
              <div class="detail-item">
                <svg
                  class="detail-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span>Nairobi, Kenya</span>
              </div>
              <div class="detail-item">
                <svg
                  class="detail-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"
                  ></path>
                </svg>
                <span>5 Acres</span>
              </div>
              <div class="detail-item">
                <svg
                  class="detail-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"
                  ></path>
                </svg>
                <span>Fertile Soil</span>
              </div>
              <div class="detail-item">
                <svg
                  class="detail-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"
                  ></path>
                </svg>
                <span>Water Source</span>
              </div>
            </div>
            <span class="land-status status-verified">Verified</span>
            <p class="land-description">
              Prime agricultural land with rich soil and year-round water
              supply. Perfect for crop farming and agricultural investments.
            </p>
            <div class="land-footer">
              <span class="land-price">$50,000</span>
              <button class="view-details">View Details</button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" style="display: none">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M3 3h18v18H3zM12 8v8M8 12h8"></path>
          </svg>
          <h2>No Lands Registered Yet</h2>
          <p>
            Start by registering your first piece of land to manage it through
            our platform.
          </p>
          <a href="/register_farm_land" class="register-land-btn"
            >Register Land</a
          >
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script type="module">
      // Initialize particles.js
      particlesJS("particles-js", {
        particles: {
          number: { value: 30, density: { enable: true, value_area: 800 } },
          color: { value: "#1a8d5f" },
          shape: { type: "circle" },
          opacity: { value: 0.1, random: true },
          size: { value: 3, random: true },
          line_linked: { enable: false },
          move: {
            enable: true,
            speed: 1,
            direction: "bottom",
            random: true,
            straight: false,
            out_mode: "out",
          },
        },
        interactivity: {
          detect_on: "canvas",
          events: {
            onhover: { enable: false },
            onclick: { enable: false },
            resize: true,
          },
        },
        retina_detect: true,
      });

      // Firebase imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import {
        getDatabase,
        ref,
        get,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
      import { getAuth } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyC_Bafxrtzdw2D3BoXCNGC4XjjyWdurnaM",
        authDomain: "tchat-af17d.firebaseapp.com",
        databaseURL: "https://tchat-af17d-default-rtdb.firebaseio.com",
        projectId: "tchat-af17d",
        storageBucket: "tchat-af17d.appspot.com",
        messagingSenderId: "895463164536",
        appId: "1:895463164536:web:c1cbfc8658ea352b373b8d",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);

      async function fetchUserLands() {
        try {
          const response = await fetch("/User_fetch_request", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ someKey: "someValue" }),
          });
          const raw_uid = await response.json();
          console.log("Fetched UID:", raw_uid);
          if (raw_uid && raw_uid.user_id) {
            const uid = raw_uid.user_id;
            const landsRef = ref(database, `users/${uid}/land/`);
            const snapshot = await get(landsRef);
            console.log("Lands snapshot:", snapshot.val());
            const landsContainer = document.querySelector(".lands-container");
            const emptyState = document.querySelector(".empty-state");

            if (snapshot.exists()) {
              const lands = snapshot.val();
              landsContainer.innerHTML = "";
              Object.entries(lands).forEach(([id, land]) => {
                const landCard = createLandCard(land);
                landsContainer.appendChild(landCard);
              });

              emptyState.style.display = "none";
            } else {
              landsContainer.innerHTML = "";
              emptyState.style.display = "block";
            }
          }
        } catch (error) {
          console.error("Error fetching lands:", error);
          alert("Failed to fetch lands. Please try again.");
        }
      }

      function createLandCard(land) {
        const card = document.createElement("div");
        card.className = "land-card";
        card.innerHTML = `
                <img src="${land.image || "https://images.unsplash.com/photo-1500382017468-9049fed747ef"}" alt="${land.title}" class="land-image">
                <div class="land-content">
                    <h3 class="land-title">${land.farmName}</h3>
                    <div class="land-details">
                        <div class="detail-item">
                            <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span>${land.farmAddress}</span>
                        </div>
                        <div class="detail-item">
                            <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"></path>
                            </svg>
                            <span>${land.totalArea} Hectors</span>
                        </div>
                        <div class="detail-item">
                            <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"></path>
                            </svg>
                            <span>${land.soilType}</span>
                        </div>
                        <div class="detail-item">
                            <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"></path>
                            </svg>
                            <span>${land.waterSource}</span>
                        </div>
                    </div>
                    <span class="land-status ${
                      land.verified ? "status-verified" : "status-pending"
                    }">
                        ${land.verified ? "Verified" : "Pending Verification"}
                    </span>
                    <p class="land-description">${land.description}</p>
                    <div class="land-footer">
                        <span class="land-price">${
                          land.price && !isNaN(land.price)
                            ? land.price.toLocaleString()
                            : "N/A"
                        }</span>
                        <button class="view-details" onclick="window.location.href='/land-details/${
                          land.id
                        }'">View Details</button>
                    </div>
                </div>
            `;
        return card;
      }

      // Initial fetch when page loads
      fetchUserLands();
    </script>
  </body>
</html>
